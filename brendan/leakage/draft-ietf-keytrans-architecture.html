<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Key Transparency Architecture</title>
<meta content="Brendan McMillion" name="author">
<meta content="
       This document defines the terminology and interaction patterns involved in the
deployment of Key Transparency (KT) in a general secure group messaging
infrastructure, and specifies the security properties that the protocol
provides. It also gives more general, non-prescriptive guidance on how to
securely apply KT to a number of common applications. 
    " name="description">
<meta content="xml2rfc 3.20.0" name="generator">
<meta content="key transparency" name="keyword">
<meta content="draft-ietf-keytrans-architecture-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.20.0
    Python 3.11.8
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-keytrans-architecture.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Key Transparency Architecture</td>
<td class="right">March 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">McMillion</td>
<td class="center">Expires 5 September 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Key Transparency</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-keytrans-architecture-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-03-04" class="published">4 March 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-09-05">5 September 2024</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. McMillion</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Key Transparency Architecture</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines the terminology and interaction patterns involved in the
deployment of Key Transparency (KT) in a general secure group messaging
infrastructure, and specifies the security properties that the protocol
provides. It also gives more general, non-prescriptive guidance on how to
securely apply KT to a number of common applications.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-keytrans.github.io/draft-arch/draft-ietf-keytrans-architecture.html">https://ietf-wg-keytrans.github.io/draft-arch/draft-ietf-keytrans-architecture.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-keytrans-architecture/">https://datatracker.ietf.org/doc/draft-ietf-keytrans-architecture/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Key Transparency Working Group mailing list (<span><a href="mailto:keytrans@ietf.org">mailto:keytrans@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/keytrans/">https://mailarchive.ietf.org/arch/browse/keytrans/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/keytrans/">https://www.ietf.org/mailman/listinfo/keytrans/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-keytrans/draft-arch">https://github.com/ietf-wg-keytrans/draft-arch</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 September 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-user-interactions" class="internal xref">User Interactions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-out-of-band-communication" class="internal xref">Out-of-Band Communication</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-deployment-modes" class="internal xref">Deployment Modes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-contact-monitoring" class="internal xref">Contact Monitoring</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-third-party-auditing" class="internal xref">Third-Party Auditing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-third-party-management" class="internal xref">Third-Party Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-combining-logs" class="internal xref">Combining Logs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-gradual-migration" class="internal xref">Gradual Migration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-immediate-migration" class="internal xref">Immediate Migration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-federation" class="internal xref">Federation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-pruning" class="internal xref">Pruning</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-guarantees" class="internal xref">Security Guarantees</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-privacy-guarantees" class="internal xref">Privacy Guarantees</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-leakage-to-third-party" class="internal xref">Leakage to Third-Party</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-privacy-law-considerations" class="internal xref">Privacy Law Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-implementation-guidance" class="internal xref">Implementation Guidance</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Before any information can be exchanged in an end-to-end encrypted system, two
things must happen. First, participants in the system must provide the service
operator with any public keys they wish to use to receive messages. Second, the
service operator must somehow distribute these public keys amongst the
participants that wish to communicate with each other.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Typically this is done by having users upload their public keys to a simple
directory where other users can download them as necessary, or by providing
public keys in-band with the communication being secured. With this approach,
the service operator needs to be trusted to provide the correct public keys,
which means that the underlying encryption protocol can only protect users
against passive eavesdropping on their messages.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">However most messaging systems are designed such that all messages exchanged
between users flow through the service operator's servers, so it's extremely
easy for an operator to launch an active attack. That is, the service operator
can provide fake public keys which it knows the private keys for, associate
those public keys with a user's account without the user's knowledge, and then
use them to impersonate or eavesdrop on conversations with that user.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Key Transparency (KT) solves this problem by requiring the service operator to
store user public keys in a cryptographically-protected append-only log. Any
malicious entries added to such a log will generally be equally visible to both
the key's owner and the owner's contacts,
in which case a user can detect that they are being impersonated
by viewing the public keys attached to their account. If the service
operator attempts to conceal some entries of the log from some users but not
others, this creates a "forked view" which is permanent and easily detectable
with out-of-band communication.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The critical improvement of KT over related protocols like Certificate
Transparency  <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> is that KT includes an efficient
protocol to search the log for entries related to a specific participant. This
means users don't need to download the entire log, which may be substantial, to
find all entries that are relevant to them. It also means that KT can better
preserve user privacy by only showing entries of the log to participants that
genuinely need to see them.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-2">
        <dt id="section-2-2.1"><strong>End-to-end Encrypted Communication Service:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.2">
          <p id="section-2-2.2.1">A communications service that allows end-users to engage in text, voice,
video, or other forms of communication over the Internet, that uses public key
cryptography to ensure that communications are only accessible to their
intended recipients.<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.3"><strong>End-user Device:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.4">
          <p id="section-2-2.4.1">The device at the final point in a digital communication, which may either
send or receive encrypted data in an end-to-end encrypted communication
service.<a href="#section-2-2.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.5"><strong>End-user Identity:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.6">
          <p id="section-2-2.6.1">A unique and user-visible identity associated with an account (and therefore
one or more end-user devices) in an end-to-end encrypted communication
service. In the case where an end-user explicitly requests to communicate with
(or is informed they are communicating with) an end-user uniquely identified
by the name "Alice", the end-user identity is the string "Alice".<a href="#section-2-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.7"><strong>User / Account:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.8">
          <p id="section-2-2.8.1">A single end-user of an end-to-end encrypted communication service, which may
be represented by several end-user identities and end-user devices. For
example, a user may be represented simultaneously by multiple identities
(email, phone number, username) and interact with the service on multiple
devices (phone, laptop).<a href="#section-2-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.9"><strong>Service Operator:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.10">
          <p id="section-2-2.10.1">The primary organization that provides the infrastructure and software
resources necessary to operate an end-to-end encrypted communication service.<a href="#section-2-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.11"><strong>Transparency Log:</strong></dt>
        <dd style="margin-left: 1.5em" id="section-2-2.12">
          <p id="section-2-2.12.1">A specialized service capable of securely attesting to the information (such
as public keys) associated with a given end-user identity. The transparency
log is usually run either entirely or partially by the service operator.<a href="#section-2-2.12.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="protocol-overview">
<section id="section-3">
      <h2 id="name-protocol-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-3-1">From a networking perspective, KT follows a client-server architecture with a
central <em>Transparency Log</em>, acting as a server, which holds the authoritative
copy of all information and exposes endpoints that allow users to query or
modify stored data. Users coordinate with each other through the server by
uploading their own public keys and/or downloading the public keys of other
users. Users are expected to maintain relatively little state, limited only
to what is required to interact with the log and ensure that it is behaving
honestly.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">From an application perspective, KT works as a versioned key-value database.
Users insert key-value pairs into the database where, for example, the key is
their username and the value is their public key. Users can update a key by
inserting a new version with new data. They can also look up the most recent
version of a key or any past version. Users are considered to <strong>own</strong> a key if,
in the normal operation of the application, they should be the only one making
changes to it. From this point forward, "key" will refer to a lookup key in a
key-value database and "public key" or "private key" will be specified if
otherwise.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">KT does not require the use of a specific transport protocol. This is intended
to allow applications to layer KT on top of whatever transport protocol their
application already uses. In particular, this allows applications to continue
relying on their existing access control system.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">Applications may enforce arbitrary access control rules on top of KT such as
requiring a user to be logged in to make KT requests, only allowing a user to
lookup the keys of another user if they're "friends", or simply applying a rate
limit. Applications <span class="bcp14">SHOULD</span> prevent users from modifying keys that they don't
own. The exact mechanism for rejecting requests, and possibly explaining the
reason for rejection, is left to the application.<a href="#section-3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="user-interactions">
<section id="section-4">
      <h2 id="name-user-interactions">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-user-interactions" class="section-name selfRef">User Interactions</a>
      </h2>
<p id="section-4-1">As discussed in <a href="#protocol-overview" class="auto internal xref">Section 3</a>, KT follows a client-server architecture.
This means users generally interact directly with the transparency log. The
operations that can be executed by a user are as follows:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1"><strong>Search:</strong> Performs a lookup on a specific key in the most recent version of
the log. Users may request either a specific version of the key, or the
most recent version available. If the key-version pair exists, the server
returns the corresponding value and a proof of inclusion.<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1"><strong>Update:</strong> Adds a new key-value pair to the log, for which the server
returns a proof of inclusion. Note that this means that new values are added
to the log immediately and no provisional inclusion proof, such as an SCT as defined in <span><a href="https://rfc-editor.org/rfc/rfc6962#section-3" class="relref">Section 3</a> of [<a href="#RFC6962" class="cite xref">RFC6962</a>]</span>, is provided.<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-4-2.3">
          <p id="section-4-2.3.1"><strong>Monitor:</strong> While Search and Update are run by the user as necessary,
monitoring is done in the background on a recurring basis. It both checks
that the log is continuing to behave honestly (all previously returned keys
remain in the tree) and that no changes have been made to keys owned by the
user without the user's knowledge.<a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-4-3">These operations are executed over an application-provided transport layer,
where the transport layer enforces access control by blocking queries which are
not allowed:<a href="#section-4-3" class="pilcrow">¶</a></p>
<span id="name-example-request-response-fl"></span><div id="request-response">
<figure id="figure-1">
        <div id="section-4-4.1">
          <div class="alignLeft art-svg artwork" id="section-4-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="336" width="456" viewBox="0 0 456 336" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 24,48 L 24,320" fill="none" stroke="black"></path>
              <path d="M 384,48 L 384,320" fill="none" stroke="black"></path>
              <path d="M 152,96 L 368,96" fill="none" stroke="black"></path>
              <path d="M 40,112 L 208,112" fill="none" stroke="black"></path>
              <path d="M 136,144 L 368,144" fill="none" stroke="black"></path>
              <path d="M 40,160 L 208,160" fill="none" stroke="black"></path>
              <path d="M 192,192 L 368,192" fill="none" stroke="black"></path>
              <path d="M 40,208 L 208,208" fill="none" stroke="black"></path>
              <path d="M 144,288 L 320,288" fill="none" stroke="black"></path>
              <path d="M 176,304 L 320,304" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="376,192 364,186.4 364,197.6" fill="black" transform="rotate(0,368,192)"></polygon>
              <polygon class="arrowhead" points="376,144 364,138.4 364,149.6" fill="black" transform="rotate(0,368,144)"></polygon>
              <polygon class="arrowhead" points="376,96 364,90.4 364,101.6" fill="black" transform="rotate(0,368,96)"></polygon>
              <polygon class="arrowhead" points="328,304 316,298.4 316,309.6" fill="black" transform="rotate(0,320,304)"></polygon>
              <polygon class="arrowhead" points="328,288 316,282.4 316,293.6" fill="black" transform="rotate(0,320,288)"></polygon>
              <polygon class="arrowhead" points="48,208 36,202.4 36,213.6" fill="black" transform="rotate(180,40,208)"></polygon>
              <polygon class="arrowhead" points="48,160 36,154.4 36,165.6" fill="black" transform="rotate(180,40,160)"></polygon>
              <polygon class="arrowhead" points="48,112 36,106.4 36,117.6" fill="black" transform="rotate(180,40,112)"></polygon>
              <g class="text">
                <text x="24" y="36">Alice</text>
                <text x="372" y="36">Transparency</text>
                <text x="440" y="36">Log</text>
                <text x="116" y="68">(Valid</text>
                <text x="152" y="68">/</text>
                <text x="196" y="68">Accepted</text>
                <text x="272" y="68">Requests)</text>
                <text x="88" y="100">Search(Alice)</text>
                <text x="296" y="116">SearchResponse(...)</text>
                <text x="80" y="148">Search(Bob)</text>
                <text x="296" y="164">SearchResponse(...)</text>
                <text x="88" y="196">Update(Alice,</text>
                <text x="164" y="196">...)</text>
                <text x="296" y="212">UpdateResponse(...)</text>
                <text x="120" y="260">(Rejected</text>
                <text x="168" y="260">/</text>
                <text x="208" y="260">Blocked</text>
                <text x="280" y="260">Requests)</text>
                <text x="84" y="292">Search(Fred)</text>
                <text x="336" y="292">X</text>
                <text x="80" y="308">Update(Bob,</text>
                <text x="148" y="308">...)</text>
                <text x="336" y="308">X</text>
              </g>
            </svg><a href="#section-4-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-request-response-fl" class="selfRef">Example request/response flow. Valid requests receive a response while invalid requests are blocked by the transport layer.</a>
        </figcaption></figure>
</div>
<p id="section-4-5">An important caveat to the client-server architecture is that many end-to-end
encrypted communication services require the ability to provide <em>credentials</em> to
their users. These credentials convey a binding between an end-user identity and
potentially several encryption or signature public keys, and are meant to be
verified with no/minimal network requests by the receiving users.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">In particular, credentials that can be verified with minimal network access are
often required by applications provide anonymous communication. These
applications provide end-to-end encryption with a protocol
like the Messaging Layer Security protocol <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> (with the encryption of
handshake messages required), or Sealed Sender <span>[<a href="#sealed-sender" class="cite xref">sealed-sender</a>]</span>. When a user
receives a message, these protocols have senders provide their own credential in
an encrypted portion of the message. Encrypting the sender's credential prevents
it from being visible to the service provider, while still assuring the
recipient of the sender's identity. If users were to authenticate the sender's
public key directly with the service provider, they would leak to the service
provider who the they are communicating with.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">Key Transparency credentials can be created by serializing one or more Search
request-response pairs. These Search operations would correspond to the lookups
a user needs to do to prove the relationship between their end-user identity and
their cryptographic keys. Recipients can verify the request-response pairs
themselves without contacting the Transparency Log.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">Any future monitoring that may be required can be provided to recipients
proactively by the sender. However if this fails, the recipient can still
perform the monitoring themselves (including over an anonymous channel if
necessary).<a href="#section-4-8" class="pilcrow">¶</a></p>
<span id="name-example-message-flow-in-an-"></span><div id="anonymous">
<figure id="figure-2">
        <div id="section-4-9.1">
          <div class="alignLeft art-svg artwork" id="section-4-9.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="224" width="504" viewBox="0 0 504 224" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 8,48 L 8,208" fill="none" stroke="black"></path>
              <path d="M 272,48 L 272,208" fill="none" stroke="black"></path>
              <path d="M 496,48 L 496,208" fill="none" stroke="black"></path>
              <path d="M 24,64 L 144,64" fill="none" stroke="black"></path>
              <path d="M 184,80 L 256,80" fill="none" stroke="black"></path>
              <path d="M 408,128 L 480,128" fill="none" stroke="black"></path>
              <path d="M 24,160 L 136,160" fill="none" stroke="black"></path>
              <path d="M 192,176 L 256,176" fill="none" stroke="black"></path>
              <path d="M 456,192 L 480,192" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="488,192 476,186.4 476,197.6" fill="black" transform="rotate(0,480,192)"></polygon>
              <polygon class="arrowhead" points="488,128 476,122.4 476,133.6" fill="black" transform="rotate(0,480,128)"></polygon>
              <polygon class="arrowhead" points="264,176 252,170.4 252,181.6" fill="black" transform="rotate(0,256,176)"></polygon>
              <polygon class="arrowhead" points="264,80 252,74.4 252,85.6" fill="black" transform="rotate(0,256,80)"></polygon>
              <polygon class="arrowhead" points="32,160 20,154.4 20,165.6" fill="black" transform="rotate(180,24,160)"></polygon>
              <polygon class="arrowhead" points="32,64 20,58.4 20,69.6" fill="black" transform="rotate(180,24,64)"></polygon>
              <g class="text">
                <text x="52" y="36">Transparency</text>
                <text x="120" y="36">Log</text>
                <text x="272" y="36">Alice</text>
                <text x="416" y="36">Anonymous</text>
                <text x="480" y="36">Group</text>
                <text x="208" y="68">Search(Alice)</text>
                <text x="96" y="84">SearchResponse(...)</text>
                <text x="332" y="84">Encrypt(Anon</text>
                <text x="412" y="84">Group,</text>
                <text x="372" y="100">SearchResponse</text>
                <text x="444" y="100">||</text>
                <text x="344" y="116">Message</text>
                <text x="404" y="116">||</text>
                <text x="356" y="132">Signature)</text>
                <text x="204" y="164">Monitor(Alice)</text>
                <text x="100" y="180">MonitorResponse(...)</text>
                <text x="332" y="180">Encrypt(Anon</text>
                <text x="412" y="180">Group,</text>
                <text x="380" y="196">MonitorResponse)</text>
              </g>
            </svg><a href="#section-4-9.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-message-flow-in-an-" class="selfRef">Example message flow in an anonymous deployment. Users request their own key from the Transparency Log and provide the serialized response, functioning as a credential, in encrypted messages to other users. Required monitoring is provided proactively.</a>
        </figcaption></figure>
</div>
<div id="out-of-band-communication">
<section id="section-4.1">
        <h3 id="name-out-of-band-communication">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-out-of-band-communication" class="section-name selfRef">Out-of-Band Communication</a>
        </h3>
<p id="section-4.1-1">It is sometimes possible for a Transparency Log to present forked views of data
to different users. This means that, from an individual user's perspective, a
log may appear to be operating correctly in the sense that all of a user's
requests succeed and proofs verify correctly. However, the Transparency Log has
presented a view to the user that's not globally consistent with what it has
shown other users. As such, the log may be able to associate data with keys
without the key owner's awareness.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The protocol is designed such that users always require subsequent queries to
prove consistency with previous queries. As such, users always stay on a
linearizable view of the log. If a user is ever presented with a forked view,
they hold on to this forked view forever and reject the output of any subsequent
queries that are inconsistent with it.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">This provides ample opportunity for users to detect when a fork has been
presented, but isn't in itself sufficient for detection. To detect forks, users
must either use <strong>peer-to-peer communication</strong> or <strong>anonymous communication</strong>
with the Transparency Log.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">With peer-to-peer communication, two users gossip with each other to establish
that they both have the same view of the log's data. This gossip is able to
happen over any supported out-of-band channel, even if it is heavily
bandwidth-limited, such as scanning a QR code or talking over the phone.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">With anonymous communication, a single user accesses the Transparency Log over
an anonymous channel and tries to establish that the log is presenting the same
view of data over the anonymous channel as it does over authenticated channels.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">In the event that a fork is successfully detected, the user is able to produce
non-repudiable proof of log misbehavior which can be published.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<span id="name-users-receive-tree-heads-wh"></span><div id="out-of-band-checking">
<figure id="figure-3">
          <div id="section-4.1-7.1">
            <div class="alignLeft art-svg artwork" id="section-4.1-7.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="304" width="584" viewBox="0 0 584 304" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,288" fill="none" stroke="black"></path>
                <path d="M 232,48 L 232,288" fill="none" stroke="black"></path>
                <path d="M 576,48 L 576,288" fill="none" stroke="black"></path>
                <path d="M 344,96 L 560,96" fill="none" stroke="black"></path>
                <path d="M 248,112 L 328,112" fill="none" stroke="black"></path>
                <path d="M 24,224 L 72,224" fill="none" stroke="black"></path>
                <path d="M 392,224 Q 394,220.8 396,224 Q 398,227.2 400,224 Q 402,220.8 404,224 Q 406,227.2 408,224 Q 410,220.8 412,224 Q 414,227.2 416,224 Q 418,220.8 420,224 Q 422,227.2 424,224 Q 426,220.8 428,224 Q 430,227.2 432,224 Q 434,220.8 436,224 Q 438,227.2 440,224 Q 442,220.8 444,224 Q 446,227.2 448,224 Q 450,220.8 452,224 Q 454,227.2 456,224 Q 458,220.8 460,224 Q 462,227.2 464,224 Q 466,220.8 468,224 Q 470,227.2 472,224 Q 474,220.8 476,224 Q 478,227.2 480,224 Q 482,220.8 484,224 Q 486,227.2 488,224 Q 490,220.8 492,224 Q 494,227.2 496,224 Q 498,220.8 500,224 Q 502,227.2 504,224 Q 506,220.8 508,224 Q 510,227.2 512,224 Q 514,220.8 516,224 Q 518,227.2 520,224 Q 522,220.8 524,224 Q 526,227.2 528,224 Q 530,220.8 532,224 Q 534,227.2 536,224 Q 538,220.8 540,224 Q 542,227.2 544,224 Q 546,220.8 548,224 Q 550,227.2 552,224 Q 554,220.8 556,224 Q 558,227.2 560,224" fill="none" stroke="black"></path>
                <path d="M 88,240 L 216,240" fill="none" stroke="black"></path>
                <path d="M 248,240 Q 250,236.8 252,240 Q 254,243.2 256,240 Q 258,236.8 260,240 Q 262,243.2 264,240 Q 266,236.8 268,240 Q 270,243.2 272,240 Q 274,236.8 276,240 Q 278,243.2 280,240 Q 282,236.8 284,240 Q 286,243.2 288,240 Q 290,236.8 292,240 Q 294,243.2 296,240 Q 298,236.8 300,240 Q 302,243.2 304,240 Q 306,236.8 308,240 Q 310,243.2 312,240 Q 314,236.8 316,240 Q 318,243.2 320,240 Q 322,236.8 324,240 Q 326,243.2 328,240 Q 330,236.8 332,240 Q 334,243.2 336,240 Q 338,236.8 340,240 Q 342,243.2 344,240 Q 346,236.8 348,240 Q 350,243.2 352,240 Q 354,236.8 356,240 Q 358,243.2 360,240 Q 362,236.8 364,240 Q 366,243.2 368,240 Q 370,236.8 372,240 Q 374,243.2 376,240 Q 378,236.8 380,240 Q 382,243.2 384,240 Q 386,236.8 388,240 Q 390,243.2 392,240 Q 394,236.8 396,240 Q 398,243.2 400,240 Q 402,236.8 404,240 Q 406,243.2 408,240 Q 410,236.8 412,240 Q 414,243.2 416,240 Q 418,236.8 420,240 Q 422,243.2 424,240 Q 426,236.8 428,240 Q 430,243.2 432,240 Q 434,236.8 436,240 Q 438,243.2 440,240 Q 442,236.8 444,240 Q 446,243.2 448,240 Q 450,236.8 452,240 Q 454,243.2 456,240 Q 458,236.8 460,240 Q 462,243.2 464,240 Q 466,236.8 468,240 Q 470,243.2 472,240 Q 474,236.8 476,240 Q 478,243.2 480,240 Q 482,236.8 484,240 Q 486,243.2 488,240 Q 490,236.8 492,240 Q 494,243.2 496,240" fill="none" stroke="black"></path>
                <path d="M 344,272 Q 346,268.8 348,272 Q 350,275.2 352,272 Q 354,268.8 356,272 Q 358,275.2 360,272 Q 362,268.8 364,272 Q 366,275.2 368,272 Q 370,268.8 372,272 Q 374,275.2 376,272 Q 378,268.8 380,272 Q 382,275.2 384,272 Q 386,268.8 388,272 Q 390,275.2 392,272 Q 394,268.8 396,272 Q 398,275.2 400,272 Q 402,268.8 404,272 Q 406,275.2 408,272 Q 410,268.8 412,272 Q 414,275.2 416,272 Q 418,268.8 420,272 Q 422,275.2 424,272 Q 426,268.8 428,272 Q 430,275.2 432,272 Q 434,268.8 436,272 Q 438,275.2 440,272 Q 442,268.8 444,272 Q 446,275.2 448,272 Q 450,268.8 452,272 Q 454,275.2 456,272 Q 458,268.8 460,272 Q 462,275.2 464,272 Q 466,268.8 468,272 Q 470,275.2 472,272 Q 474,268.8 476,272 Q 478,275.2 480,272 Q 482,268.8 484,272 Q 486,275.2 488,272 Q 490,268.8 492,272 Q 494,275.2 496,272" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,224 556,218.4 556,229.6" fill="black" transform="rotate(0,560,224)"></polygon>
                <polygon class="arrowhead" points="568,96 556,90.4 556,101.6" fill="black" transform="rotate(0,560,96)"></polygon>
                <polygon class="arrowhead" points="504,272 492,266.4 492,277.6" fill="black" transform="rotate(0,496,272)"></polygon>
                <polygon class="arrowhead" points="256,240 244,234.4 244,245.6" fill="black" transform="rotate(180,248,240)"></polygon>
                <polygon class="arrowhead" points="256,112 244,106.4 244,117.6" fill="black" transform="rotate(180,248,112)"></polygon>
                <polygon class="arrowhead" points="224,240 212,234.4 212,245.6" fill="black" transform="rotate(0,216,240)"></polygon>
                <polygon class="arrowhead" points="32,224 20,218.4 20,229.6" fill="black" transform="rotate(180,24,224)"></polygon>
                <g class="text">
                  <text x="24" y="36">Alice</text>
                  <text x="232" y="36">Bob</text>
                  <text x="500" y="36">Transparency</text>
                  <text x="568" y="36">Log</text>
                  <text x="272" y="68">(Normal</text>
                  <text x="324" y="68">reqs</text>
                  <text x="364" y="68">over</text>
                  <text x="440" y="68">authenticated</text>
                  <text x="532" y="68">channel)</text>
                  <text x="288" y="100">Search(Bob)</text>
                  <text x="396" y="116">Response{Head:</text>
                  <text x="492" y="116">6c063bb,</text>
                  <text x="548" y="116">...}</text>
                  <text x="52" y="196">(OOB</text>
                  <text x="96" y="196">check</text>
                  <text x="140" y="196">with</text>
                  <text x="184" y="196">peer)</text>
                  <text x="284" y="196">(OOB</text>
                  <text x="328" y="196">check</text>
                  <text x="372" y="196">over</text>
                  <text x="432" y="196">anonymous</text>
                  <text x="508" y="196">channel)</text>
                  <text x="152" y="228">DistinguishedHead</text>
                  <text x="312" y="228">DistinguishedHead</text>
                  <text x="48" y="244">6c063bb</text>
                  <text x="536" y="244">6c063bb</text>
                  <text x="288" y="276">Search(Bob)</text>
                  <text x="512" y="276">X</text>
                </g>
              </svg><a href="#section-4.1-7.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-users-receive-tree-heads-wh" class="selfRef">Users receive tree heads while making authenticated requests to a Transparency Log. Users ensure consistency of tree heads by either comparing amongst themselves, or by contacting the Transparency Log over an anonymous channel. Requests that require authorization are not available over the anonymous channel.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="deployment-modes">
<section id="section-5">
      <h2 id="name-deployment-modes">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-deployment-modes" class="section-name selfRef">Deployment Modes</a>
      </h2>
<p id="section-5-1">In the interest of satisfying the widest range of use-cases possible, three
different modes for deploying a Transparency Log are supported. Each mode has
slightly different requirements and efficiency considerations for both the
transparency log and the end-user.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2"><strong>Third-Party Management</strong> and <strong>Third-Party Auditing</strong> are two deployment modes
that require the transparency log to delegate part of its operation
to a third party. Users are able to run more efficiently as
long as they can assume that the transparency log and the third party won't
collude to trick them into accepting malicious results.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">With both third-party modes, all requests from end-users are initially routed to
the transparency log and the log coordinates with the third party
itself. End-users never contact the third party directly, however they will
need a signature public key from the third party to verify its assertions.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">With Third-Party Management, the third party performs the majority of the work
of actually storing and operating the service, and the transparency log only
signs new entries as they're added. With Third-Party Auditing, the transparency
log performs the majority of the work of storing and operating the service, and
obtains signatures from a lightweight third-party auditor at regular intervals
asserting that the tree has been constructed correctly.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5"><strong>Contact Monitoring</strong>, on the other hand, supports a single-party deployment
with no third party. The cost of this is that executing the background monitoring
protocol requires an amount of work that's proportional to the number of keys a
user has looked up in the past. As such, it's less suited to use-cases where
users look up a large number of ephemeral keys, but would work ideally in a
use-case where users look up a limited number of keys repeatedly (for example, the
keys of regular contacts).<a href="#section-5-5" class="pilcrow">¶</a></p>
<span id="name-comparison-of-deployment-mo"></span><table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-comparison-of-deployment-mo" class="selfRef">Comparison of deployment modes</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Deployment Mode</th>
            <th class="text-left" rowspan="1" colspan="1">Supports ephemeral keys?</th>
            <th class="text-left" rowspan="1" colspan="1">Single party?</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Contact Monitoring</td>
            <td class="text-left" rowspan="1" colspan="1">No</td>
            <td class="text-left" rowspan="1" colspan="1">Yes</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Third-Party Auditing</td>
            <td class="text-left" rowspan="1" colspan="1">Yes</td>
            <td class="text-left" rowspan="1" colspan="1">No</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Third-Party Management</td>
            <td class="text-left" rowspan="1" colspan="1">Yes</td>
            <td class="text-left" rowspan="1" colspan="1">No</td>
          </tr>
        </tbody>
      </table>
<p id="section-5-7">Applications that rely on a Transparency Log deployed in Contact Monitoring mode
<span class="bcp14">MUST</span> regularly engage in out-of-band communication
(<a href="#out-of-band-communication" class="auto internal xref">Section 4.1</a>) to ensure that they detect forks in a timely
manner.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">Applications that rely on a Transparency Log deployed in either of the
third-party modes <span class="bcp14">SHOULD</span> allow users to enable a "Contact Monitoring Mode". This
mode, which affects only the individual client's behavior, would cause the
client to behave as if its Transparency Log was deployed in Contact Monitoring
mode. As such, it would start retaining state about previously looked-up keys
and regularly engaging in out-of-band communication. Enabling this
higher-security mode allows users to double-check that the third-party is not
colluding with the Transparency Log to serve malicious data.<a href="#section-5-8" class="pilcrow">¶</a></p>
<div id="contact-monitoring">
<section id="section-5.1">
        <h3 id="name-contact-monitoring">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-contact-monitoring" class="section-name selfRef">Contact Monitoring</a>
        </h3>
<p id="section-5.1-1">With the Contact Monitoring deployment mode, the monitoring burden is split
between both the owner of a key and those that look up the key. Stated as simply
as possible, the monitoring obligations of each party are:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2">
<li id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">The key owner, on a regular basis, searches for the most recent version of
the key in the log. They verify that the key has not changed unexpectedly.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">The users that looked up a key, at some point in the future, verify that the
key-value pair they observed is still properly represented in the tree such
that other users would find it if they searched for it.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.1-3">This guarantees that if a malicious key-value pair is added to the log, then
either it is detected by the key owner, or if it is removed/obscured from the
log before the key owner can detect it, then any users that observed it will
detect its removal.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<span id="name-contact-monitoring-when-use"></span><div id="contact-monitoring-fig">
<figure id="figure-4">
          <div id="section-5.1-4.1">
            <div class="alignLeft art-svg artwork" id="section-5.1-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="432" width="584" viewBox="0 0 584 432" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,416" fill="none" stroke="black"></path>
                <path d="M 296,48 L 296,416" fill="none" stroke="black"></path>
                <path d="M 576,48 L 576,416" fill="none" stroke="black"></path>
                <path d="M 120,64 L 280,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 120,80" fill="none" stroke="black"></path>
                <path d="M 128,160 L 280,160" fill="none" stroke="black"></path>
                <path d="M 24,176 L 112,176" fill="none" stroke="black"></path>
                <path d="M 128,256 L 280,256" fill="none" stroke="black"></path>
                <path d="M 24,272 L 112,272" fill="none" stroke="black"></path>
                <path d="M 312,304 L 456,304" fill="none" stroke="black"></path>
                <path d="M 480,320 L 560,320" fill="none" stroke="black"></path>
                <path d="M 128,352 L 280,352" fill="none" stroke="black"></path>
                <path d="M 24,368 L 112,368" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,320 556,314.4 556,325.6" fill="black" transform="rotate(0,560,320)"></polygon>
                <polygon class="arrowhead" points="320,304 308,298.4 308,309.6" fill="black" transform="rotate(180,312,304)"></polygon>
                <polygon class="arrowhead" points="288,352 276,346.4 276,357.6" fill="black" transform="rotate(0,280,352)"></polygon>
                <polygon class="arrowhead" points="288,256 276,250.4 276,261.6" fill="black" transform="rotate(0,280,256)"></polygon>
                <polygon class="arrowhead" points="288,160 276,154.4 276,165.6" fill="black" transform="rotate(0,280,160)"></polygon>
                <polygon class="arrowhead" points="288,64 276,58.4 276,69.6" fill="black" transform="rotate(0,280,64)"></polygon>
                <polygon class="arrowhead" points="32,368 20,362.4 20,373.6" fill="black" transform="rotate(180,24,368)"></polygon>
                <polygon class="arrowhead" points="32,272 20,266.4 20,277.6" fill="black" transform="rotate(180,24,272)"></polygon>
                <polygon class="arrowhead" points="32,176 20,170.4 20,181.6" fill="black" transform="rotate(180,24,176)"></polygon>
                <polygon class="arrowhead" points="32,80 20,74.4 20,85.6" fill="black" transform="rotate(180,24,80)"></polygon>
                <g class="text">
                  <text x="24" y="36">Alice</text>
                  <text x="284" y="36">Transparency</text>
                  <text x="352" y="36">Log</text>
                  <text x="568" y="36">Bob</text>
                  <text x="64" y="68">Search(Bob)</text>
                  <text x="208" y="84">SearchResponse(...)</text>
                  <text x="108" y="132">(1</text>
                  <text x="136" y="132">day</text>
                  <text x="180" y="132">later)</text>
                  <text x="68" y="164">Monitor(Bob)</text>
                  <text x="204" y="180">MonitorResponse(...)</text>
                  <text x="100" y="228">(2</text>
                  <text x="132" y="228">days</text>
                  <text x="180" y="228">later)</text>
                  <text x="68" y="260">Monitor(Bob)</text>
                  <text x="204" y="276">MonitorResponse(...)</text>
                  <text x="516" y="308">Monitor(Bob)</text>
                  <text x="100" y="324">(4</text>
                  <text x="132" y="324">days</text>
                  <text x="180" y="324">later)</text>
                  <text x="388" y="324">MonitorResponse(...)</text>
                  <text x="68" y="356">Monitor(Bob)</text>
                  <text x="204" y="372">MonitorResponse(...)</text>
                  <text x="144" y="404">...</text>
                </g>
              </svg><a href="#section-5.1-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-contact-monitoring-when-use" class="selfRef">Contact Monitoring. When users make a Search request, they must check back in with the Transparency Log several times. These checks ensure that the data in the Search response wasn't later removed from the log. Overlap with the key owner's own monitoring guarantees a consistent view of data.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="third-party-auditing">
<section id="section-5.2">
        <h3 id="name-third-party-auditing">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-third-party-auditing" class="section-name selfRef">Third-Party Auditing</a>
        </h3>
<p id="section-5.2-1">With the Third-Party Auditing deployment mode, the transparency log obtains
signatures from a lightweight third-party auditor attesting to the fact that the
tree has been constructed correctly. These signatures are
provided to users along with the responses for their queries.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The third-party auditor is expected to run asynchronously, downloading and
authenticating a log's contents in the background, so as not to become a
bottleneck for the transparency log.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<span id="name-third-party-auditing-a-rece"></span><div id="auditing-fig">
<figure id="figure-5">
          <div id="section-5.2-3.1">
            <div class="alignLeft art-svg artwork" id="section-5.2-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="208" width="584" viewBox="0 0 584 208" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,192" fill="none" stroke="black"></path>
                <path d="M 336,48 L 336,192" fill="none" stroke="black"></path>
                <path d="M 576,48 L 576,192" fill="none" stroke="black"></path>
                <path d="M 176,64 L 320,64" fill="none" stroke="black"></path>
                <path d="M 160,80 L 320,80" fill="none" stroke="black"></path>
                <path d="M 176,96 L 320,96" fill="none" stroke="black"></path>
                <path d="M 24,110 L 64,110" fill="none" stroke="black"></path>
                <path d="M 24,114 L 64,114" fill="none" stroke="black"></path>
                <path d="M 448,160 L 560,160" fill="none" stroke="black"></path>
                <path d="M 352,176 L 432,176" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="568,160 556,154.4 556,165.6" fill="black" transform="rotate(0,560,160)"></polygon>
                <polygon class="arrowhead" points="360,176 348,170.4 348,181.6" fill="black" transform="rotate(180,352,176)"></polygon>
                <polygon class="arrowhead" points="328,96 316,90.4 316,101.6" fill="black" transform="rotate(0,320,96)"></polygon>
                <polygon class="arrowhead" points="328,80 316,74.4 316,85.6" fill="black" transform="rotate(0,320,80)"></polygon>
                <polygon class="arrowhead" points="328,64 316,58.4 316,69.6" fill="black" transform="rotate(0,320,64)"></polygon>
                <polygon class="arrowhead" points="32,112 20,106.4 20,117.6" fill="black" transform="rotate(180,24,112)"></polygon>
                <g class="text">
                  <text x="20" y="36">Many</text>
                  <text x="64" y="36">Users</text>
                  <text x="324" y="36">Transparency</text>
                  <text x="392" y="36">Log</text>
                  <text x="552" y="36">Auditor</text>
                  <text x="72" y="68">Update(Alice,</text>
                  <text x="148" y="68">...)</text>
                  <text x="64" y="84">Update(Bob,</text>
                  <text x="132" y="84">...)</text>
                  <text x="72" y="100">Update(Carol,</text>
                  <text x="148" y="100">...)</text>
                  <text x="156" y="116">Response{AuditorSig:</text>
                  <text x="264" y="116">66bf,</text>
                  <text x="308" y="116">...}</text>
                  <text x="392" y="164">BatchUpdate</text>
                  <text x="472" y="180">NewSig:</text>
                  <text x="536" y="180">53c1035</text>
                </g>
              </svg><a href="#section-5.2-3.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-third-party-auditing-a-rece" class="selfRef">Third-Party Auditing. A recent signature from the auditor is provided to users. The auditor is updated on changes to the tree in the background.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="third-party-management">
<section id="section-5.3">
        <h3 id="name-third-party-management">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-third-party-management" class="section-name selfRef">Third-Party Management</a>
        </h3>
<p id="section-5.3-1">With the Third-Party Management deployment mode, a third party is responsible
for the majority of the work of storing and operating the log, while the
transparency log serves mainly to enforce access control and authenticate the addition
of new entries to the log. All user queries are initially sent by users directly
to the transparency log, and the log operator proxies them to the
third-party manager if they pass access control.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<span id="name-third-party-management-vali"></span><div id="manager-fig">
<figure id="figure-6">
          <div id="section-5.3-2.1">
            <div class="alignLeft art-svg artwork" id="section-5.3-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="208" width="520" viewBox="0 0 520 208" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,48 L 8,192" fill="none" stroke="black"></path>
                <path d="M 248,48 L 248,192" fill="none" stroke="black"></path>
                <path d="M 512,48 L 512,192" fill="none" stroke="black"></path>
                <path d="M 136,64 L 232,64" fill="none" stroke="black"></path>
                <path d="M 264,64 L 496,64" fill="none" stroke="black"></path>
                <path d="M 24,80 L 232,80" fill="none" stroke="black"></path>
                <path d="M 264,80 L 336,80" fill="none" stroke="black"></path>
                <path d="M 176,112 L 232,112" fill="none" stroke="black"></path>
                <path d="M 264,112 L 496,112" fill="none" stroke="black"></path>
                <path d="M 24,128 L 232,128" fill="none" stroke="black"></path>
                <path d="M 264,128 L 336,128" fill="none" stroke="black"></path>
                <path d="M 128,160 L 208,160" fill="none" stroke="black"></path>
                <path d="M 160,176 L 208,176" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="504,112 492,106.4 492,117.6" fill="black" transform="rotate(0,496,112)"></polygon>
                <polygon class="arrowhead" points="504,64 492,58.4 492,69.6" fill="black" transform="rotate(0,496,64)"></polygon>
                <polygon class="arrowhead" points="272,128 260,122.4 260,133.6" fill="black" transform="rotate(180,264,128)"></polygon>
                <polygon class="arrowhead" points="272,80 260,74.4 260,85.6" fill="black" transform="rotate(180,264,80)"></polygon>
                <polygon class="arrowhead" points="240,112 228,106.4 228,117.6" fill="black" transform="rotate(0,232,112)"></polygon>
                <polygon class="arrowhead" points="240,64 228,58.4 228,69.6" fill="black" transform="rotate(0,232,64)"></polygon>
                <polygon class="arrowhead" points="216,176 204,170.4 204,181.6" fill="black" transform="rotate(0,208,176)"></polygon>
                <polygon class="arrowhead" points="216,160 204,154.4 204,165.6" fill="black" transform="rotate(0,208,160)"></polygon>
                <polygon class="arrowhead" points="32,128 20,122.4 20,133.6" fill="black" transform="rotate(180,24,128)"></polygon>
                <polygon class="arrowhead" points="32,80 20,74.4 20,85.6" fill="black" transform="rotate(180,24,80)"></polygon>
                <g class="text">
                  <text x="24" y="36">Alice</text>
                  <text x="236" y="36">Transparency</text>
                  <text x="304" y="36">Log</text>
                  <text x="488" y="36">Manager</text>
                  <text x="72" y="68">Search(Alice)</text>
                  <text x="424" y="84">SearchResponse(...)</text>
                  <text x="72" y="116">Update(Alice,</text>
                  <text x="148" y="116">...)</text>
                  <text x="424" y="132">UpdateResponse(...)</text>
                  <text x="68" y="164">Search(Fred)</text>
                  <text x="224" y="164">X</text>
                  <text x="64" y="180">Update(Bob,</text>
                  <text x="132" y="180">...)</text>
                  <text x="224" y="180">X</text>
                </g>
              </svg><a href="#section-5.3-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-third-party-management-vali" class="selfRef">Third-Party Management. Valid requests are proxied by the Transparency Log to the Manager. Rejected requests are blocked.</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="combining-logs">
<section id="section-6">
      <h2 id="name-combining-logs">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-combining-logs" class="section-name selfRef">Combining Logs</a>
      </h2>
<p id="section-6-1">There are many cases where it makes sense to operate multiple cooperating log
instances, for example:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">A service provider may decide that it's prudent to rotate its cryptographic
keys, or migrate to a new deployment mode. They can do this by creating a new
log instance with new cryptographic keys, operating under a new
deployment mode if desired, and migrating their data from the old log to the
new log while users are able to query both.<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">A service provider may choose to operate multiple logs to improve their
ability to scale or provide higher availability.<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">A federated system may allow each participant in the federation to operate
their own log for their own users.<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-6-3">Client implementations should generally be prepared to interact with multiple
logs simultaneously. In particular, clients <span class="bcp14">SHOULD</span> namespace any configuration
or state related to a particular log, such that information related to different
logs do not conflict.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">When multiple logs are used, all users in the system <span class="bcp14">MUST</span> have a consistent
policy for executing Search, Update, and Monitor queries against the logs in a
way that maintains the high-level security guarantees of KT:<a href="#section-6-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-5.1">
          <p id="section-6-5.1.1">If all logs behave honestly, then users observe a globally-consistent view of
the data associated with each key.<a href="#section-6-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-5.2">
          <p id="section-6-5.2.1">If any log behaves dishonestly such that the prior guarantee is not met (some
users observe data associated with a key that others do not), this will be
detected either immediately or in a timely manner by background monitoring.<a href="#section-6-5.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="gradual-migration">
<section id="section-6.1">
        <h3 id="name-gradual-migration">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-gradual-migration" class="section-name selfRef">Gradual Migration</a>
        </h3>
<p id="section-6.1-1">In the case of gradually migrating from an old log to a new one, this policy may
look like:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1-2">
<li id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">Search queries should be executed against the old log first, and then against
the new log only if the most recent version of a key in the old log is a
special application-defined 'tombstone' entry.<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">Update queries should only be executed against the new log, adding a
tombstone entry to the old log if one hasn't been already created.<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-2.3">
            <p id="section-6.1-2.3.1">Both logs should be monitored as they would be if they were run individually.
Once the migration has completed and the old log has stopped accepting
changes, the old log <span class="bcp14">MUST</span> stay operational long enough for all users to
complete their monitoring of it (keeping in mind that some users may be
offline for a significant amount of time).<a href="#section-6.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.1-3">Placing a tombstone entry for each key in the old log gives users a clear
indication as to which log contains the most recent version of a key and
prevents them from incorrectly accepting a stale version if the new log rejects
a search query.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="immediate-migration">
<section id="section-6.2">
        <h3 id="name-immediate-migration">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-immediate-migration" class="section-name selfRef">Immediate Migration</a>
        </h3>
<p id="section-6.2-1">In the event of a key compromise, the service provider may instead choose to
stop adding new entries to a log immediately and provide a new log that is
pre-populated with the most recent versions of all keys. In this case, the
policy may look like:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-2">
<li id="section-6.2-2.1">
            <p id="section-6.2-2.1.1">Search queries must be executed against the new log.<a href="#section-6.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.2">
            <p id="section-6.2-2.2.1">Update queries must be executed against the new log.<a href="#section-6.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.3">
            <p id="section-6.2-2.3.1">The final tree size and root hash of the old log should be provided to users
over a trustworthy channel. Users will use this to do any final monitoring of
the old log, and then ensure that the most recent versions of the keys they
own are properly represented in the new log. From then on, users will monitor
only the new log.<a href="#section-6.2-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.2-3">The final tree size and root hash of the prior log must be distributed to users
in a way that guarantees all users have a globally-consistent view. This can be
done either by storing them in a well-known key of the new log, or with the
application's code distribution mechanism.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="federation">
<section id="section-6.3">
        <h3 id="name-federation">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-federation" class="section-name selfRef">Federation</a>
        </h3>
<p id="section-6.3-1">In a federated application, many servers that are owned and operated by
different entities will cooperate to provide a single end-to-end encrypted
communication service. Each entity in a federated system provides its own
infrastructure (in particular, a transparency log) to serve the users that rely
on it. Given this, there must be a consistent policy for directing KT requests
to the correct transparency log. Typically in such a system, the end-user
identity directly specifies which entity requests should be directed to. For
example, with an email end-user identity like <code>alice@example.com</code>, the
controlling entity is <code>example.com</code>.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">A controlling entity like <code>example.com</code> may act as an anonymizing proxy for its
users when querying transparency logs run by other entities (in the manner of
<span>[<a href="#RFC9458" class="cite xref">RFC9458</a>]</span>), but should not attempt to 'mirror' or combine other transparency
logs with its own.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pruning">
<section id="section-7">
      <h2 id="name-pruning">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-pruning" class="section-name selfRef">Pruning</a>
      </h2>
<p id="section-7-1">As part of the core infrastructure of an end-to-end encrypted communication
service, Transparency Logs are required to operate seamlessly for several years.
This presents a problem for general append-only logs, as even moderate usage can
cause the log to grow to an unmanageable size. This issue is further compounded
by the fact that a substantial portion of the entries added to a log may be
fake, having been added solely for the purpose of obscuring short-term update
rates (as discussed in <a href="#privacy-guarantees" class="auto internal xref">Section 8.1</a>). Given this, Transparency Logs
need to be able manage their footprint by pruning data which is no longer
required by the communication service.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">Broadly speaking, a Transparency Log's database will contain two types of data:<a href="#section-7-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-3">
<li id="section-7-3.1">
          <p id="section-7-3.1.1">Serialized user data (the values corresponding to keys in the log), and<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-3.2">
          <p id="section-7-3.2.1">Cryptographic data, such as pre-computed portions of hash trees or commitment
openings.<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-7-4">The first type, serialized user data, can be pruned by removing any entries that
the service operator's access control policy would never permit access to. For
example, a service operator may only permit clients to search for the most
recent version (or <code>n</code> versions) of a key. Any entries that don't meet this
criteria can be deleted without consideration to the rest of the protocol.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">The second type, cryptographic data, can also be pruned, but only after
considering which parts are no longer required by the protocol for producing
proofs. For example, even though the key-value pair inserted at a particular
entry in the append-only log may have been deleted, parts of the log entry may
still be needed to produce proofs for Search / Update / Monitor queries on other
keys. The exact mechanism for determining which data is safe to delete will
depend on the implementation.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">The distinction between user data and cryptographic data provides a valuable
separation of concerns, given that the protocol document does not provide a
mechanism for a service operator to convey its access control policy to a
Transparency Log. That is: pruning user data can be done entirely by
application-defined code, while pruning cryptographic data can be done entirely
by KT-specific code as a subsequent operation.<a href="#section-7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-guarantees">
<section id="section-8">
      <h2 id="name-security-guarantees">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-guarantees" class="section-name selfRef">Security Guarantees</a>
      </h2>
<p id="section-8-1">A user that correctly verifies a proof from the Transparency Log (and does any
required monitoring afterwards) receives a guarantee that the Transparency Log
operator executed the key-value lookup correctly, and in a way that's globally
consistent with what it has shown all other users. That is, when a user searches
for a key, they're guaranteed that the result they receive represents the same
result that any other user searching for the same key would've seen. When a user
modifies a key, they're guaranteed that other users will see the modification
the next time they search for the key.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">If the Transparency Log operator does not execute a key-value lookup correctly,
then either:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-3">
<li id="section-8-3.1">
          <p id="section-8-3.1.1">The user will detect the error immediately and reject the proof, or<a href="#section-8-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-3.2">
          <p id="section-8-3.2.1">The user will permanently enter an invalid state.<a href="#section-8-3.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-4">Depending on the exact reason that the user enters an invalid state, it will
either be detected by background monitoring or the next time that out-of-band
communication is available. Importantly, this means that users must stay
online for some bounded amount of time after entering an invalid state for it to
be successfully detected.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">Alternatively, instead of executing a lookup incorrectly, the Transparency Log
can attempt to prevent a user from learning about more recent states of the log.
This would allow the log to continue executing queries correctly, but on
outdated versions of data. To prevent this, applications configure an upper
bound on how stale a query response can be without being rejected.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">The exact caveats of the above guarantees depend naturally on the security of
underlying cryptographic primitives, and also the deployment mode that the
Transparency Log relies on:<a href="#section-8-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-7.1">
          <p id="section-8-7.1.1">Third-Party Management and Third-Party Auditing require an assumption that the
transparency log and the third-party manager/auditor do not collude
to trick users into accepting malicious results.<a href="#section-8-7.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-7.2">
          <p id="section-8-7.2.1">Contact Monitoring requires an assumption that the user that owns a key and
all users that look up the key do the necessary monitoring afterwards.<a href="#section-8-7.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-8">In short, assuming that the underlying cryptographic primitives used are secure,
any deployment-specific assumptions hold (such as non-collusion), and that user
devices don't go permanently offline, then malicious behavior by the
Transparency Log is always detected within a bounded amount of time. The
parameters that determine the maximum amount of time before malicious behavior
is detected are as follows:<a href="#section-8-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-9.1">
          <p id="section-8-9.1.1">How stale an application allows query responses to be (ie, how long an
application is willing to go without seeing updates to the tree).<a href="#section-8-9.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-9.2">
          <p id="section-8-9.2.1">How frequently users execute background monitoring.<a href="#section-8-9.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-9.3">
          <p id="section-8-9.3.1">How frequently users exercise out-of-band communication.<a href="#section-8-9.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-9.4">
          <p id="section-8-9.4.1">For third-party auditing: the maximum amount of lag that an auditor is allowed
to have, with respect to the most recent tree head.<a href="#section-8-9.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="privacy-guarantees">
<section id="section-8.1">
        <h3 id="name-privacy-guarantees">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-privacy-guarantees" class="section-name selfRef">Privacy Guarantees</a>
        </h3>
<p id="section-8.1-1">For applications deploying KT, service operators expect to be able to control
when sensitive information is revealed. In particular, an operator can often
only reveal that a user is a member of their service, and information about that
user's account, to that user's friends or contacts.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">KT only allows users to learn whether or not a lookup key exists in the
Transparency Log if the user obtains a valid search proof for that key.
Similarly, KT only allows users to learn about the contents of a log entry if
the user obtains a valid search proof for the exact key and version stored at
that log entry.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Applications are primarily able to manage the privacy of their data in KT by
relying on these properties when they enforce access control policies on the
queries issued by users, as discussed in <a href="#protocol-overview" class="auto internal xref">Section 3</a>. For example if
two users aren't friends, an application can block these users from searching
for each other's lookup keys. This prevents the two users from learning about
each other's existence. If the users were previously friends but no longer are,
the application can prevent the users from searching for each other's keys and
learning the contents of any subsequent account updates.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">Service operators also expect to be able to control sensitive population-level
metrics about their users. These metrics include the size of their userbase, the
frequency with which new users join, and the frequency with which existing users
update their keys.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">KT allows a service operator to obscure the size of its userbase by padding the
tree with fake entries. Similarly, it also allows a service operator to obscure
the rate at which changes are made by padding real changes with fake ones,
causing outsiders to observe a baseline constant rate of changes.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<div id="leakage-to-third-party">
<section id="section-8.1.1">
          <h4 id="name-leakage-to-third-party">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-leakage-to-third-party" class="section-name selfRef">Leakage to Third-Party</a>
          </h4>
<p id="section-8.1.1-1">In the event that a third-party auditor or manager is used, there's additional
information leaked to the third-party that's not visible to outsiders.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">In the case of a third-party auditor, the auditor is able to learn the total
number of distinct changes to the log. It is also able to learn the order and
approximate timing with which each change was made. However, auditors are not
able to learn the plaintext of any keys or values. This is because keys
are masked with a VRF, and values are only provided to auditors as commitments.
They are also not able to distinguish between whether a change represents a key
being created for the first time or being updated, or whether a change
represents a "real" change from an end-user or a "fake" padding change.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1.1-3">In the case of a third-party manager, the manager generally learns everything
that the service operator would know. This includes the total set of plaintext
keys and values and their modification history. It also includes traffic
patterns, such as how often a specific key is looked up.<a href="#section-8.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="privacy-law-considerations">
<section id="section-9">
      <h2 id="name-privacy-law-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-law-considerations" class="section-name selfRef">Privacy Law Considerations</a>
      </h2>
<p id="section-9-1">Consumer privacy laws often provide a 'right to erasure', meaning that when a
consumer requests that a service provider delete their personal information, the
service provider is legally obligated to do so. This may seem to be incompatible
with the description of KT in <a href="#introduction" class="auto internal xref">Section 1</a> as an 'append-only log'. Once an
entry is added to a transparency log, it indeed can not be removed.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The important caveat here is that user data is not directly stored in the
append-only log. Instead, the log consists of privacy-preserving cryptographic
commitments. By logging commitments instead of plaintext user data, users
interacting with the log are unable to infer anything about an entry's contents
until the service provider explicitly provides the commitment's opening. A
service provider responding to an erasure request can delete the commitment
opening and the associated data, effectively anonymizing the entry.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">Other than the log, the second place where user information is stored is in the
<em>prefix tree</em>. This is a cryptographic index provided to users to allow them to
efficiently query the log, which contains information about which lookup keys
exist and where. These lookup keys are usually serialized end-user identifiers,
although it varies by application. To minimize leakage, all lookup keys are
processed through a Verifiable Random Function, or VRF <span>[<a href="#RFC9381" class="cite xref">RFC9381</a>]</span>.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">A VRF deterministically maps each lookup key to the fixed-length pseudorandom
value. The VRF can only be executed by the service operator, who holds a private
key. But critically, VRFs can still provide a proof that an input-output pair is
valid, which users verify with a public key. When a user tries to search for or
update a key, the service operator first executes its VRF on the input lookup
key to obtain the output key that will actually be looked up or stored in the
prefix tree. The service operator then provides the output key, along with a
proof that the output key is correct, in its response to the user.<a href="#section-9-4" class="pilcrow">¶</a></p>
<p id="section-9-5">The pseudorandom output of VRFs means that even if a user indirectly observes
that a search key exists in the prefix tree, they can't immediately learn which
user the search key identifies. The inability of users to execute the VRF
themselves also prevents offline "password cracking" approaches, where an
attacker tries all possibilities in a low entropy space (like the set of phone
numbers) to find the input that produces a given search key.<a href="#section-9-5" class="pilcrow">¶</a></p>
<p id="section-9-6">A service provider responding to an erasure request can 'trim' the prefix tree,
by no longer storing the full VRF output for any lookup keys corresponding to an
end-user's identifiers. With only a small amount of the VRF output left in
storage, even if the transparency log is later compromised, it would be unable
to recover deleted identifiers. If the same lookup keys were reinserted into the
log at a later time, it would appear as if they were being inserted for the
first time.<a href="#section-9-6" class="pilcrow">¶</a></p>
<p id="section-9-7">As an example, consider the information stored in a transparency log after
inserting a key <code>K</code> with value <code>V</code>. The value stored in the prefix tree would
roughly correspond to <code>VRF(key K) = pseudorandom bytes</code>, and the value stored in
the append-only log would roughly correspond to:<a href="#section-9-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9-8">
<pre>
Commit(nonce: random bytes, body: version N of key K is V)
</pre><a href="#section-9-8" class="pilcrow">¶</a>
</div>
<p id="section-9-9">After receiving an erasure request, the transparency log deletes the key, value,
and random commitment nonce. It also trims the VRF output to the minimum size
necessary. The commitment scheme guarantees that, without the high-entropy
random nonce, the remaining commitment reveals nothing about the key or value.<a href="#section-9-9" class="pilcrow">¶</a></p>
<p id="section-9-10">Assuming that the prefix tree is well-balanced (which is extremely likely due to
VRFs being pseudorandom), the number of VRF output bits retained is
approximately equal to the logarithm of the total number of keys logged. This
means that while the VRF's full output may be 256 bits, in a log with one
million keys, only 20 output bits would need to be retained. This would be
insufficient for recovering even a very low-entropy identifier like a phone
number.<a href="#section-9-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-guidance">
<section id="section-10">
      <h2 id="name-implementation-guidance">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-implementation-guidance" class="section-name selfRef">Implementation Guidance</a>
      </h2>
<p id="section-10-1">Fundamentally, KT can be thought of as guaranteeing that all the users of a
service agree on the contents of a key-value database. Using this guarantee,
that all users agree on a set of keys and values, to authenticate the
relationship between end-user identities and the end-users of a communication
service takes special care. Critically, in order to authenticate an end-user
identity, it must be both <em>unique</em> and <em>user-visible</em>. However, what exactly
constitutes a unique and user-visible identifier varies greatly from application
to application.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">Consider, for example, a communication service where users are uniquely
identified by a fixed username, but KT has been deployed using an internal UUID
as the lookup key. While the UUID might be unique, it is not user-visible. When
a user attempts to lookup a contact by username, the service operator must
translate the username into its UUID. Since this mapping (from username to UUID)
is unauthenticated, the service operator can manipulate it to eavesdrop on
conversations by returning the UUID for an account that it controls. From a
security perspective, this is equivalent to not using KT at all. An example of
this kind of application would be email.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">However in other applications, the use of internal UUIDs in KT may be
appropriate. For example, many applications don't have this type of fixed
username and instead use their UI (underpinned internally by a UUID) to indicate
to users whether a conversation is with a new person or someone they've
previously contacted. The fact that the UI behaves in this way makes the UUID a
user-visible identifer, even if a user may not be able to actually see it
written out. An example of this kind of application would be Slack.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">A <strong>primary end-user identity</strong> is one that is unique, user-visible, and unable
to change. (Or equivalently, if it changes, it appears in the application UI as
a new conversation with a new user.) A primary end-user identity should always
be a lookup key in KT, with the end-user's public keys as the associated value.<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">A <strong>secondary end-user identity</strong> is one that is unique, user-visible, and able
to change without being interpreted as a different account due to its
association with a primary identity. Examples of this type of identity include
phone numbers, or most usernames. These identities are used solely for initial
user discovery, in which they're converted to a primary identity that's used by
the application from then on. A secondary end-user identity should be a lookup
key in KT, for the purpose of authenticating user discovery, with the primary
end-user identity as the associated value.<a href="#section-10-5" class="pilcrow">¶</a></p>
<p id="section-10-6">While likely helpful to most common applications, the distinction between
handling primary and secondary identities is not a hard-and-fast rule.
Applications must be careful to ensure they fully capture the semantics of
identity in their application with the key-value structure they put in KT.<a href="#section-10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">This document has no IANA actions.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC6962">[RFC6962]</dt>
        <dd>
<span class="refAuthor">Laurie, B.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Kasper</span>, <span class="refTitle">"Certificate Transparency"</span>, <span class="seriesInfo">RFC 6962</span>, <span class="seriesInfo">DOI 10.17487/RFC6962</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6962">https://www.rfc-editor.org/rfc/rfc6962</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9381">[RFC9381]</dt>
        <dd>
<span class="refAuthor">Goldberg, S.</span>, <span class="refAuthor">Reyzin, L.</span>, <span class="refAuthor">Papadopoulos, D.</span>, and <span class="refAuthor">J. Včelák</span>, <span class="refTitle">"Verifiable Random Functions (VRFs)"</span>, <span class="seriesInfo">RFC 9381</span>, <span class="seriesInfo">DOI 10.17487/RFC9381</span>, <time datetime="2023-08" class="refDate">August 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9381">https://www.rfc-editor.org/rfc/rfc9381</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9420">[RFC9420]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="seriesInfo">RFC 9420</span>, <span class="seriesInfo">DOI 10.17487/RFC9420</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9420">https://www.rfc-editor.org/rfc/rfc9420</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9458">[RFC9458]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="seriesInfo">RFC 9458</span>, <span class="seriesInfo">DOI 10.17487/RFC9458</span>, <time datetime="2024-01" class="refDate">January 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9458">https://www.rfc-editor.org/rfc/rfc9458</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="sealed-sender">[sealed-sender]</dt>
      <dd>
<span class="refTitle">"Technology preview: Sealed sender for Signal"</span>, <time datetime="2018-10-29" class="refDate">29 October 2018</time>, <span>&lt;<a href="https://signal.org/blog/sealed-sender/">https://signal.org/blog/sealed-sender/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Brendan McMillion</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:brendanmcmillion@gmail.com" class="email">brendanmcmillion@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
